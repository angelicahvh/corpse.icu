<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/png" href="pfp.png" />
  <title>corpse</title>
  <style>
    /* Your existing styles */
    /* (abbreviated here for brevity; include all your previous CSS) */

    .album-art-wrapper img { /* preserve the vinyl spin styles */
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      animation: spin 5s linear infinite;
      animation-play-state: paused;
    }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* Visualizer canvas styling */
    #visualizer {
      width: 200px;
      height: 68px;
      background: transparent;
    }
  </style>
</head>
<body>
  <!-- Particles, social, profile, etc. (all your existing layout) -->

  <!-- Audio Player + Visualizer area -->
  <div class="audio-player glass">
    <div class="album-art-wrapper">
      <img id="album-art" src="" alt="Album Art" />
    </div>
    <div class="info">
      <strong id="song-title">Loading…</strong>
      <span id="artist-name">…</span>
      <div class="progress-container">
        <span id="current-time">0:00</span>
        <div id="progress-bar-container"><div id="progress-bar"></div></div>
        <span id="duration">0:00</span>
      </div>
      <div class="controls">
        <button id="prev-btn">⏮</button>
        <button id="play-btn">▶</button>
        <button id="next-btn">⏭</button>
      </div>
    </div>
    <canvas id="visualizer"></canvas>
  </div>

  <!-- Hidden Spotify embed -->
  <iframe id="spotify-embed" style="display:none"
    src="https://open.spotify.com/embed/track/06RKqktximm0kH8NVvxTyN"
    allow="encrypted-media"></iframe>

  <!-- Include ColorThief and rest of your scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.umd.js"></script>
  <script>
    const spotifyLink = "https://open.spotify.com/track/06RKqktximm0kH8NVvxTyN";
    const embed = document.getElementById("spotify-embed");
    const playBtn = document.getElementById("play-btn");
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const albumArt = document.getElementById("album-art");
    const titleEl = document.getElementById("song-title");
    const artistEl = document.getElementById("artist-name");

    // Initialize visualizer
    const canvas = document.getElementById("visualizer");
    const ctx = canvas.getContext("2d");
    let osc, audioCtx, gainNode;

    function initVisualizer() {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      osc = audioCtx.createOscillator();
      gainNode = audioCtx.createGain();
      osc.connect(gainNode).connect(audioCtx.destination);
      osc.type = "sine";
      osc.frequency.value = 0;
      gainNode.gain.value = 0;
      osc.start();
      requestAnimationFrame(drawVisualizer);
    }

    function drawVisualizer() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (!audioPaused) {
        gainNode.gain.setTargetAtTime(0.1, audioCtx.currentTime, 0.01);
        osc.frequency.setTargetAtTime(440, audioCtx.currentTime, 0.01);
        const barHeight = Math.random() * canvas.height;
        ctx.fillStyle = "#ff3b81";
        ctx.fillRect(0, canvas.height - barHeight, canvas.width, barHeight);
      } else {
        gainNode.gain.setTargetAtTime(0, audioCtx.currentTime, 0.01);
      }
      requestAnimationFrame(drawVisualizer);
    }

    initVisualizer();

    // Fetch metadata via public oEmbed API
    fetch(`https://open.spotify.com/oembed?url=${encodeURIComponent(spotifyLink)}`)
      .then(res => res.json())
      .then(data => {
        titleEl.textContent = data.title;
        artistEl.textContent = data.author_name;
        albumArt.src = data.thumbnail_url;
      })
      .catch(() => {
        titleEl.textContent = "Unknown Track";
        artistEl.textContent = "";
      });

    let audioPaused = true;

    playBtn.addEventListener("click", () => {
      if (!audioPaused) {
        embed.contentWindow.postMessage('{"method":"pause"}', '*');
        audioPaused = true;
        playBtn.textContent = "▶";
        albumArt.style.animationPlayState = "paused";
      } else {
        embed.contentWindow.postMessage('{"method":"play"}', '*');
        audioPaused = false;
        playBtn.textContent = "⏸";
        albumArt.style.animationPlayState = "running";
      }
    });

    // Add scrub and progress logic if desired (can mimic original)

    // Optional: disable prev/next since embed is single track
    prevBtn.disabled = true;
    nextBtn.disabled = true;
  </script>
</body>
</html>
