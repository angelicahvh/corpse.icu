<script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.umd.js"></script>
<script>
  // Typewriter Title
  const fullTitle = ".nuwdep";
  let index = 1;
  let direction = 1;
  const speed = 150;

  function typewriterLoop() {
    document.title = fullTitle.substring(0, index);
    if (direction === 1 && index === fullTitle.length) {
      direction = -1;
      setTimeout(typewriterLoop, 1000);
    } else if (direction === -1 && index === 1) {
      direction = 1;
      setTimeout(typewriterLoop, 500);
    } else {
      index += direction;
      setTimeout(typewriterLoop, speed);
    }
  }
  window.addEventListener("load", typewriterLoop);

  // Audio Player Logic
  const audio = document.getElementById("bg-music");
  const playBtn = document.getElementById("play-btn");
  const progressBar = document.getElementById("progress-bar");
  const currentTimeEl = document.getElementById("current-time");
  const durationEl = document.getElementById("duration");
  const albumArt = document.getElementById("album-art");
  const progressContainer = document.getElementById("progress-bar-container");

  // Play / Pause button toggle
  playBtn.addEventListener("click", () => {
    if (audio.paused) {
      audio.play();
      playBtn.textContent = "⏸";
    } else {
      audio.pause();
      playBtn.textContent = "▶";
    }
  });

  // Update progress & timestamps
  audio.addEventListener("timeupdate", () => {
    if (!isDragging) {
      const progress = (audio.currentTime / audio.duration) * 100;
      progressBar.style.width = `${progress}%`;
      currentTimeEl.textContent = formatTime(audio.currentTime);
    }
  });

  audio.addEventListener("loadedmetadata", () => {
    durationEl.textContent = formatTime(audio.duration);
  });

  // --- Draggable progress bar ---
  let isDragging = false;

  progressContainer.addEventListener("mousedown", (e) => {
    isDragging = true;
    seek(e);
  });

  document.addEventListener("mousemove", (e) => {
    if (isDragging) {
      seek(e);
    }
  });

  document.addEventListener("mouseup", () => {
    if (isDragging) {
      isDragging = false;
    }
  });

  function seek(e) {
    const rect = progressContainer.getBoundingClientRect();
    const offsetX = e.clientX - rect.left;
    const width = rect.width;
    const percent = Math.min(Math.max(offsetX / width, 0), 1);
    audio.currentTime = percent * audio.duration;
    progressBar.style.width = `${percent * 100}%`;
    currentTimeEl.textContent = formatTime(audio.currentTime);
  }

  function formatTime(seconds) {
    if (isNaN(seconds)) return "0:00";
    const minutes = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60).toString().padStart(2, "0");
    return `${minutes}:${secs}`;
  }

  // Set progress bar color based on album art dominant color
  albumArt.onload = () => {
    const colorThief = new ColorThief();
    const color = colorThief.getColor(albumArt);
    progressBar.style.backgroundColor = `rgb(${color[0]}, ${color[1]}, ${color[2]})`;
  };

  // Clock
  function updateClock() {
    const now = new Date();
    document.getElementById("clock").innerText = now.toLocaleTimeString();
  }
  setInterval(updateClock, 1000);
  updateClock();

  // Particles.js Config (Subtle)
  particlesJS("particles-js", {
    particles: {
      number: { value: 30 },
      color: { value: "#ffffff" },
      shape: { type: "circle" },
      opacity: { value: 0.2 },
      size: { value: 2 },
      move: { speed: 0.6 }
    }
  });
</script>
